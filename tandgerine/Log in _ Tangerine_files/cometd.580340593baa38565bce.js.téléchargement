(self.webpackChunkTangerine_FBE=self.webpackChunkTangerine_FBE||[]).push([[9027],{17886:function(e){e.exports=function(){var e=function(){var e=0,t={};this.register=function(n){var i=++e;return t[i]=n,i},this.unregister=function(e){var n=t[e];return delete t[e],n},this.setTimeout=function(e,t){return window.setTimeout(e,t)},this.clearTimeout=function(e){window.clearTimeout(e)}};function t(){var e={};self.onmessage=function(t){var n=t.data,i=e[n.id];switch(n.type){case"setTimeout":e[n.id]=self.setTimeout((function(){delete e[n.id],self.postMessage({id:n.id})}),n.delay);break;case"clearTimeout":delete e[n.id],i&&self.clearTimeout(i);break;default:throw"Unknown command "+n.type}}}var n={isString:function(e){return null!=e&&("string"==typeof e||e instanceof String)},isArray:function(e){return null!=e&&e instanceof Array},inArray:function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1}},i=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,i,r){for(var o=[],s=0;s<e.length;++s){var a=e[s];!0===t[a].accept(n,i,r)&&o.push(a)}return o},this.negotiateTransport=function(n,i,r,o){for(var s=0;s<e.length;++s)for(var a=e[s],c=0;c<n.length;++c)if(a===n[c]){var u=t[a];if(!0===u.accept(i,r,o))return u}return null},this.add=function(n,i,r){for(var o=!1,s=0;s<e.length;++s)if(e[s]===n){o=!0;break}return o||("number"!=typeof r?e.push(n):e.splice(r,0,n),t[n]=i),!o},this.find=function(n){for(var i=0;i<e.length;++i)if(e[i]===n)return t[n];return null},this.remove=function(n){for(var i=0;i<e.length;++i)if(e[i]===n){e.splice(i,1);var r=t[n];return delete t[n],r}return null},this.clear=function(){e=[],t={}},this.reset=function(n){for(var i=0;i<e.length;++i)t[e[i]].reset(n)}},r=function(){var e,t,i;this.registered=function(n,i){e=n,t=i},this.unregistered=function(){e=null,t=null},this._debug=function(){t._debug.apply(t,arguments)},this._mixin=function(){return t._mixin.apply(t,arguments)},this.getConfiguration=function(){return t.getConfiguration()},this.getAdvice=function(){return t.getAdvice()},this.setTimeout=function(e,n){return t.setTimeout(e,n)},this.clearTimeout=function(e){t.clearTimeout(e)},this.convertToMessages=function(e){if(n.isString(e))try{return JSON.parse(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(n.isArray(e))return e;if(null==e)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+typeof e},this.accept=function(e,t,n){throw"Abstract"},this.getType=function(){return e},this.getURL=function(){return i},this.setURL=function(e){i=e},this.send=function(e,t){throw"Abstract"},this.reset=function(t){this._debug("Transport",e,"reset",t?"initial":"retry")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}};r.derive=function(e){function t(){}return t.prototype=e,new t};var o=function(){var e=new r,t=r.derive(e),i=0,o=null,s=[],a=[];function c(e){for(;a.length>0;){var t=a[0],n=t[0],i=t[1];if(n.url!==e.url||n.sync!==e.sync)break;a.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",i.id)}}function u(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var n=this.getConfiguration().maxNetworkDelay,i=n;!0===t.metaConnect&&(i+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",i,"ms for the response, maxNetworkDelay",n);var r=this;t.timeout=this.setTimeout((function(){t.expired=!0;var n="Request "+t.id+" of transport "+r.getType()+" exceeded "+i+" ms max network delay",o={reason:n},s=t.xhr;o.httpCode=r.xhrStatus(s),r.abortXHR(s),r._debug(n),r.complete(t,!1,t.metaConnect),e.onFailure(s,e.messages,o)}),i)}}function l(e){var t=++i,n={id:t,metaConnect:!1,envelope:e};s.length<this.getConfiguration().maxConnections-1?(s.push(n),u.call(this,e,n)):(this._debug("Transport",this.getType(),"queueing request",t,"envelope",e),a.push([e,n]))}function f(e){var t=e.id;if(this._debug("Transport",this.getType(),"/meta/connect complete, request",t),null!==o&&o.id!==t)throw"/meta/connect request mismatch, completing request "+t;o=null}function h(e,t){var i=n.inArray(e,s);if(i>=0&&s.splice(i,1),a.length>0){var r=a.shift(),o=r[0],u=r[1];if(this._debug("Transport dequeued request",u.id),t)this.getConfiguration().autoBatch&&c.call(this,o),l.call(this,o),this._debug("Transport completed request",e.id,o);else{var f=this;this.setTimeout((function(){f.complete(u,!1,u.metaConnect);var e={reason:"Previous request failed"},t=u.xhr;e.httpCode=f.xhrStatus(t),o.onFailure(t,o.messages,e)}),0)}}}function d(e){if(null!==o)throw"Concurrent /meta/connect requests not allowed, request id="+o.id+" not yet completed";var t=++i;this._debug("Transport",this.getType(),"/meta/connect send, request",t,"envelope",e);var n={id:t,metaConnect:!0,envelope:e};u.call(this,e,n),o=n}return t.complete=function(e,t,n){n?f.call(this,e):h.call(this,e,t)},t.transportSend=function(e,t){throw"Abstract"},t.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},t.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},t.send=function(e,t){t?d.call(this,e):l.call(this,e)},t.abort=function(){e.abort();for(var t=0;t<s.length;++t){var n=s[t];n&&(this._debug("Aborting request",n),this.abortXHR(n.xhr)||this.transportFailure(n.envelope,n,{reason:"abort"}))}var i=o;i&&(this._debug("Aborting /meta/connect request",i),this.abortXHR(i.xhr)||this.transportFailure(i.envelope,i,{reason:"abort"})),this.reset(!0)},t.reset=function(t){e.reset(t),o=null,s=[],a=[]},t.abortXHR=function(e){if(e)try{var t=e.readyState;return e.abort(),t!==window.XMLHttpRequest.UNSENT}catch(e){this._debug(e)}return!1},t.xhrStatus=function(e){if(e)try{return e.status}catch(e){this._debug(e)}return-1},t},s=function(){var e=new o,t=r.derive(e),n=!0;function i(e){try{e.context=t.context}catch(e){this._debug("Could not copy transport context into XHR",e)}}return t.accept=function(e,t,i){return n||!t},t.newXMLHttpRequest=function(){return new window.XMLHttpRequest},t.xhrSend=function(e){var n=t.newXMLHttpRequest();i(n),n.withCredentials=!0,n.open("POST",e.url,!0!==e.sync);var r=e.headers;if(r)for(var o in r)r.hasOwnProperty(o)&&n.setRequestHeader(o,r[o]);return n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.onload=function(){200===n.status?e.onSuccess(n.responseText):e.onError(n.statusText)},n.onabort=n.onerror=function(){e.onError(n.statusText)},n.send(e.body),n},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var i=this;try{var r=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(e.messages),onSuccess:function(r){i._debug("Transport",i.getType(),"received response",r);var o=!1;try{var s=i.convertToMessages(r);0===s.length?(n=!1,i.transportFailure(e,t,{httpCode:204})):(o=!0,i.transportSuccess(e,t,s))}catch(r){if(i._debug(r),!o){n=!1;var a={exception:r};a.httpCode=i.xhrStatus(t.xhr),i.transportFailure(e,t,a)}}},onError:function(o,s){i._debug("Transport",i.getType(),"received error",o,s),n=!1;var a={reason:o,exception:s};a.httpCode=i.xhrStatus(t.xhr),r?i.setTimeout((function(){i.transportFailure(e,t,a)}),0):i.transportFailure(e,t,a)}}),r=!1}catch(r){n=!1,this.setTimeout((function(){i.transportFailure(e,t,{exception:r})}),0)}},t.reset=function(t){e.reset(t),n=!0},t},a=function(){var e=new o,t=r.derive(e),n=0;function i(e,t,n){var i=this;return function(){i.transportFailure(e,t,"error",n)}}return t.accept=function(e,t,n){return!0},t.jsonpSend=function(e){var t=document.getElementsByTagName("head")[0],i=document.createElement("script"),r="_cometd_jsonp_"+n++;window[r]=function(n){t.removeChild(i),delete window[r],e.onSuccess(n)};var o=e.url;o+=o.indexOf("?")<0?"?":"&",o+="jsonp="+r,o+="&message="+encodeURIComponent(e.body),i.src=o,i.async=!0!==e.sync,i.type="application/javascript",i.onerror=function(t){e.onError("jsonp "+t.type)},t.appendChild(i)},t.transportSend=function(e,t){for(var n=this,r=0,o=e.messages.length,s=[];o>0;){var a=JSON.stringify(e.messages.slice(r,r+o)),c=e.url.length+encodeURI(a).length,u=this.getConfiguration().maxURILength;if(c>u){if(1===o){var l="Bayeux message too big ("+c+" bytes, max is "+u+") for transport "+this.getType();return void this.setTimeout(i.call(this,e,t,l),0)}--o}else s.push(o),r+=o,o=e.messages.length-r}var f=e;if(s.length>1){var h=0,d=s[0];this._debug("Transport",this.getType(),"split",e.messages.length,"messages into",s.join(" + ")),(f=this._mixin(!1,{},e)).messages=e.messages.slice(h,d),f.onSuccess=e.onSuccess,f.onFailure=e.onFailure;for(var g=1;g<s.length;++g){var p=this._mixin(!1,{},e);h=d,d+=s[g],p.messages=e.messages.slice(h,d),p.onSuccess=e.onSuccess,p.onFailure=e.onFailure,this.send(p,t.metaConnect)}}this._debug("Transport",this.getType(),"sending request",t.id,"envelope",f);try{var m=!0;this.jsonpSend({transport:this,url:f.url,sync:f.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(f.messages),onSuccess:function(e){var i=!1;try{var r=n.convertToMessages(e);0===r.length?n.transportFailure(f,t,{httpCode:204}):(i=!0,n.transportSuccess(f,t,r))}catch(e){n._debug(e),i||n.transportFailure(f,t,{exception:e})}},onError:function(e,i){var r={reason:e,exception:i};m?n.setTimeout((function(){n.transportFailure(f,t,r)}),0):n.transportFailure(f,t,r)}}),m=!1}catch(e){this.setTimeout((function(){n.transportFailure(f,t,{exception:e})}),0)}},t},c=function(){var e,t=new r,i=r.derive(t),o=!0,s=!1,a=!0,c=null,u=null,l=!1,f=null;function h(e,t){e&&(this.webSocketClose(e,t.code,t.reason),this.onClose(e,t))}function d(e){return e===u||e===c}function g(e,t,n){for(var i=[],r=0;r<t.messages.length;++r){var o=t.messages[r];o.id&&i.push(o.id)}e.envelopes[i.join(",")]=[t,n],this._debug("Transport",this.getType(),"stored envelope, envelopes",e.envelopes)}function p(t){if(!u){var n=e.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",n);try{var i=e.getConfiguration().protocol;t.webSocket=i?new window.WebSocket(n,i):new window.WebSocket(n),u=t}catch(e){throw o=!1,this._debug("Exception while creating WebSocket object",e),e}a=!1!==e.getConfiguration().stickyReconnect;var r=this,l=e.getConfiguration().connectTimeout;l>0&&(t.connectTimer=this.setTimeout((function(){e._debug("Transport",r.getType(),"timed out while connecting to URL",n,":",l,"ms"),h.call(r,t,{code:1e3,reason:"Connect Timeout"})}),l));var f=function(){e._debug("WebSocket onopen",t),t.connectTimer&&r.clearTimeout(t.connectTimer),d(t)?(u=null,c=t,s=!0,r.onOpen(t)):(e._warn("Closing extra WebSocket connection",this,"active connection",c),h.call(r,t,{code:1e3,reason:"Extra Connection"}))},g=function(n){n=n||{code:1e3},e._debug("WebSocket onclose",t,n,"connecting",u,"current",c),t.connectTimer&&r.clearTimeout(t.connectTimer),r.onClose(t,n)},p=function(n){e._debug("WebSocket onmessage",n,t),r.onMessage(t,n)};t.webSocket.onopen=f,t.webSocket.onclose=g,t.webSocket.onerror=function(){g({code:1e3,reason:"Error"})},t.webSocket.onmessage=p,this._debug("Transport",this.getType(),"configured callbacks on",t)}}function m(t,n,i){var r=JSON.stringify(n.messages);t.webSocket.send(r),this._debug("Transport",this.getType(),"sent",n,"/meta/connect =",i);var o=this.getConfiguration().maxNetworkDelay,s=o;i&&(s+=this.getAdvice().timeout,l=!0);for(var a=this,c=[],u=0;u<n.messages.length;++u)!function(){var i=n.messages[u];i.id&&(c.push(i.id),t.timeouts[i.id]=a.setTimeout((function(){e._debug("Transport",a.getType(),"timing out message",i.id,"after",s,"on",t),h.call(a,t,{code:1e3,reason:"Message Timeout"})}),s))}();this._debug("Transport",this.getType(),"waiting at most",s,"ms for messages",c,"maxNetworkDelay",o,", timeouts:",t.timeouts)}function v(e,t,n){try{null===e?(e=u||{envelopes:{},timeouts:{}},g.call(this,e,t,n),p.call(this,e)):(g.call(this,e,t,n),m.call(this,e,t,n))}catch(t){var i=this;this.setTimeout((function(){h.call(i,e,{code:1e3,reason:"Exception",exception:t})}),0)}}return i.reset=function(e){t.reset(e),o=!0,e&&(s=!1),a=!0,c=null,u=null,l=!1},i._notifySuccess=function(e,t){e.call(this,t)},i._notifyFailure=function(e,t,n,i){e.call(this,t,n,i)},i.onOpen=function(e){var t=e.envelopes;for(var n in this._debug("Transport",this.getType(),"opened",e,"pending messages",t),t)if(t.hasOwnProperty(n)){var i=t[n],r=i[0],o=i[1];f=r.onSuccess,m.call(this,e,r,o)}},i.onMessage=function(e,t){this._debug("Transport",this.getType(),"received websocket message",t,e);for(var i=!1,r=this.convertToMessages(t.data),o=[],s=0;s<r.length;++s){var a=r[s];if((/^\/meta\//.test(a.channel)||void 0===a.data)&&a.id){o.push(a.id);var c=e.timeouts[a.id];c&&(this.clearTimeout(c),delete e.timeouts[a.id],this._debug("Transport",this.getType(),"removed timeout for message",a.id,", timeouts",e.timeouts))}"/meta/connect"===a.channel&&(l=!1),"/meta/disconnect"!==a.channel||l||(i=!0)}for(var u=!1,h=e.envelopes,d=0;d<o.length;++d){var g=o[d];for(var p in h)if(h.hasOwnProperty(p)){var m=p.split(","),v=n.inArray(g,m);if(v>=0){u=!0,m.splice(v,1);var b=h[p][0],y=h[p][1];delete h[p],m.length>0&&(h[m.join(",")]=[b,y]);break}}}u&&this._debug("Transport",this.getType(),"removed envelope, envelopes",h),this._notifySuccess(f,r),i&&this.webSocketClose(e,1e3,"Disconnect")},i.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t),d(e)&&(o=a&&s,u=null,c=null);var n=e.timeouts;for(var i in e.timeouts={},n)n.hasOwnProperty(i)&&this.clearTimeout(n[i]);var r=e.envelopes;for(var f in e.envelopes={},r)if(r.hasOwnProperty(f)){var h=r[f][0];r[f][1]&&(l=!1);var g={websocketCode:t.code,reason:t.reason};t.exception&&(g.exception=t.exception),this._notifyFailure(h.onFailure,e,h.messages,g)}},i.registered=function(n,i){t.registered(n,i),e=i},i.accept=function(t,n,i){return this._debug("Transport",this.getType(),"accept, supported:",o),o&&!!window.WebSocket&&!1!==e.websocketEnabled},i.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"/meta/connect =",t),v.call(this,c,e,t)},i.webSocketClose=function(e,t,n){try{e.webSocket&&e.webSocket.close(t,n)}catch(e){this._debug(e)}},i.abort=function(){t.abort(),h.call(this,c,{code:1e3,reason:"Abort"}),this.reset(!0)},i},u=function(r){var o,u,l,f,h,d=new e,g=this,p=r||"default",m=!1,v=new i,b="disconnected",y=0,T=null,w=0,x=[],k=!1,_=0,C={},S=0,R=null,I=[],L={},U={},E={},q=!1,B=!1,F=0,A=0,M=null,O={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2e3,advice:{timeout:6e4,interval:0,reconnect:void 0,maxInterval:0}};function P(e,t){try{return e[t]}catch(e){return}}function D(e){return n.isString(e)}function N(e){return null!=e&&"function"==typeof e}function j(e,t){for(var n="";--t>0&&!(e>=Math.pow(10,t));)n+="0";return n+=e}function H(e,t){if(window.console){var n=window.console[e];if(N(n)){var i=new Date;[].splice.call(t,0,0,j(i.getHours(),2)+":"+j(i.getMinutes(),2)+":"+j(i.getSeconds(),2)+"."+j(i.getMilliseconds(),3)),n.apply(window.console,t)}}}function W(e){return new RegExp("(^https?://)?(((\\[[^\\]]+])|([^:/?#]+))(:(\\d+))?)?([^?#]*)(.*)?").exec(e)}function X(e){g._debug("Configuring cometd object with",e),D(e)&&(e={url:e}),e||(e={}),O=g._mixin(!1,O,e);var n=g.getURL();if(!n)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var i=W(n),r=i[2],o=i[8],s=i[9];if(m=g._isCrossDomain(r),O.appendMessageTypeToURL)if(void 0!==s&&s.length>0)g._info("Appending message type to URI "+o+s+" is not supported, disabling 'appendMessageTypeToURL' configuration"),O.appendMessageTypeToURL=!1;else{var a=o.split("/"),c=a.length-1;o.match(/\/$/)&&(c-=1),a[c].indexOf(".")>=0&&(g._info("Appending message type to URI "+o+" is not supported, disabling 'appendMessageTypeToURL' configuration"),O.appendMessageTypeToURL=!1)}if(window.Worker&&window.Blob&&window.URL&&O.useWorkerScheduler){var u=t.toString();u=u.substring(u.indexOf("{")+1,u.lastIndexOf("}"));var l=new window.Blob([u],{type:"application/json"}),f=window.URL.createObjectURL(l),h=new window.Worker(f);d.setTimeout=function(e,t){var n=d.register(e);return h.postMessage({id:n,type:"setTimeout",delay:t}),n},d.clearTimeout=function(e){d.unregister(e),h.postMessage({id:e,type:"clearTimeout"})},h.onmessage=function(e){var t=e.data.id,n=d.unregister(t);n&&n()}}}function J(e){if(e){var t=C[e.channel];t&&t[e.id]&&(delete t[e.id],g._debug("Removed",e.listener?"listener":"subscription",e))}}function V(e){e&&!e.listener&&J(e)}function z(){for(var e in C)if(C.hasOwnProperty(e)){var t=C[e];if(t)for(var n in t)t.hasOwnProperty(n)&&V(t[n])}}function Z(e){b!==e&&(g._debug("Status",b,"->",e),b=e)}function $(){return"disconnecting"===b||"disconnected"===b}function G(){return""+ ++y}function K(e,t,n,i,r){try{return t.call(e,i)}catch(e){var o=g.onExtensionException;if(N(o)){g._debug("Invoking extension exception handler",n,e);try{o.call(g,e,n,r,i)}catch(e){g._info("Exception during execution of extension exception handler",n,e)}}else g._info("Exception during execution of extension",n,e);return i}}function Q(e){for(var t=0;t<I.length&&null!=e;++t){var n=I[t],i=n.extension.incoming;if(N(i)){var r=K(n.extension,i,n.name,e,!1);e=void 0===r?e:r}}return e}function Y(e){for(var t=I.length-1;t>=0&&null!=e;--t){var n=I[t],i=n.extension.outgoing;if(N(i)){var r=K(n.extension,i,n.name,e,!0);e=void 0===r?e:r}}return e}function ee(e,t){var n=C[e];if(n)for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];if(r)try{r.callback.call(r.scope,t)}catch(e){var o=g.onListenerException;if(N(o)){g._debug("Invoking listener exception handler",r,e);try{o.call(g,e,r,r.listener,t)}catch(e){g._info("Exception during execution of listener exception handler",r,e)}}else g._info("Exception during execution of listener",r,t,e)}}}function te(e,t){ee(e,t);for(var n=e.split("/"),i=n.length-1,r=i;r>0;--r){var o=n.slice(0,r).join("/")+"/*";r===i&&ee(o,t),ee(o+="*",t)}}function ne(){null!==R&&g.clearTimeout(R),R=null}function ie(e,t){ne();var n=L.interval+t;g._debug("Function scheduled in",n,"ms, interval =",L.interval,"backoff =",S,e),R=g.setTimeout(e,n)}function re(e,t,n,i){for(var r=0;r<t.length;++r){var s=t[r],a=s.id;T&&(s.clientId=T),null!=(s=Y(s))?(s.id=a,t[r]=s):(delete U[a],t.splice(r--,1))}if(0!==t.length){n&&(M=t[0]);var c=g.getURL();O.appendMessageTypeToURL&&(c.match(/\/$/)||(c+="/"),i&&(c+=i));var u={url:c,sync:e,messages:t,onSuccess:function(e){try{f.call(g,e)}catch(e){g._info("Exception during handling of messages",e)}},onFailure:function(e,t,n){try{var i=g.getTransport();n.connectionType=i?i.getType():"unknown",h.call(g,e,t,n)}catch(e){g._info("Exception during handling of failure",e)}}};g._debug("Send",u),o.send(u,n)}}function oe(e){w>0||!0===k?x.push(e):re(!1,[e],!1)}function se(){S=0}function ae(){return S<O.maxBackoff&&(S+=O.backoffIncrement),S}function ce(){++w,g._debug("Starting batch, depth",w)}function ue(){var e=x;x=[],e.length>0&&re(!1,e,!1)}function le(){if(--w,g._debug("Ending batch, depth",w),w<0)throw"Calls to startBatch() and endBatch() are not paired";0!==w||$()||k||ue()}function fe(){if(!$()){var e={id:G(),channel:"/meta/connect",connectionType:o.getType()};B||(e.advice={timeout:0}),Z("connecting"),g._debug("Connect sent",e),re(!1,[e],!0,"connect"),Z("connected")}}function he(e){Z("connecting"),ie((function(){fe()}),e)}function de(e){e&&(L=g._mixin(!1,{},O.advice,e),g._debug("New advice",L))}function ge(e){if(ne(),e&&o&&o.abort(),m=!1,o=null,Z("disconnected"),T=null,w=0,se(),q=!1,B=!1,F=0,M=null,x.length>0){var t=x;x=[],h.call(g,void 0,t,{reason:"Disconnected"})}}function pe(e,t,n){var i=g.onTransportException;if(N(i)){g._debug("Invoking transport exception handler",e,t,n);try{i.call(g,n,e,t)}catch(e){g._info("Exception during execution of transport exception handler",e)}}}function me(e,t){N(e)&&(t=e,e=void 0),T=null,z(),$()&&v.reset(!0),de({}),w=0,k=!0,u=e,l=t;var n="1.0",i=g.getURL(),r=v.findTransportTypes(n,m,i),s={id:G(),version:n,minimumVersion:n,channel:"/meta/handshake",supportedConnectionTypes:r,advice:{timeout:L.timeout,interval:L.interval}},a=g._mixin(!1,{},u,s);if(g._putCallback(a.id,t),!o&&!(o=v.negotiateTransport(r,n,m,i))){var c="Could not find initial transport among: "+v.getTransportTypes();throw g._warn(c),c}g._debug("Initial transport is",o.getType()),Z("handshaking"),g._debug("Handshake sent",a),re(!1,[a],!1,"handshake")}function ve(e){Z("handshaking"),k=!0,ie((function(){me(u,l)}),e)}function be(e,t){try{e.call(g,t)}catch(e){var n=g.onCallbackException;if(N(n)){g._debug("Invoking callback exception handler",e);try{n.call(g,e,t)}catch(e){g._info("Exception during execution of callback exception handler",e)}}else g._info("Exception during execution of message callback",e)}}function ye(e){var t=g._getCallback([e.id]);N(t)&&(delete U[e.id],be(t,e))}function Te(e){var t=E[e.id];if(delete E[e.id],t){g._debug("Handling remote call response for",e,"with context",t);var n=t.timeout;n&&g.clearTimeout(n);var i=t.callback;if(N(i))return be(i,e),!0}return!1}function we(e){g._debug("Transport failure handling",e),e.transport&&(o=e.transport),e.url&&o.setURL(e.url);var t=e.action,n=e.delay||0;switch(t){case"handshake":ve(n);break;case"retry":he(n);break;case"none":ge(!0);break;default:throw"Unknown action "+t}}function xe(e,t){ye(e),te("/meta/handshake",e),te("/meta/unsuccessful",e),$()&&(t.action="none"),g.onTransportFailure.call(g,e,t,we)}function ke(e){var t=g.getURL();if(e.successful){var n=g._isCrossDomain(W(t)[2]),i=v.negotiateTransport(e.supportedConnectionTypes,e.version,n,t);if(null===i)return e.successful=!1,void xe(e,{cause:"negotiation",action:"none",transport:null});o!==i&&(g._debug("Transport",o.getType(),"->",i.getType()),o=i),T=e.clientId,k=!1,ue(),e.reestablish=q,q=!0,ye(e),te("/meta/handshake",e),A=e["x-messages"]||0;var r=$()?"none":L.reconnect||"retry";switch(r){case"retry":se(),0===A?he(0):g._debug("Processing",A,"handshake-delivered messages");break;case"none":ge(!0);break;default:throw"Unrecognized advice action "+r}}else xe(e,{cause:"unsuccessful",action:L.reconnect||"handshake",transport:o})}function _e(e){xe(e,{cause:"failure",action:"handshake",transport:null})}function Ce(e){return"disconnected"===b||!(!M||M.id!==e.id)&&(M=null,!0)}function Se(e,t){te("/meta/connect",e),te("/meta/unsuccessful",e),$()&&(t.action="none"),g.onTransportFailure.call(g,e,t,we)}function Re(e){if(Ce(e))if(B=e.successful){te("/meta/connect",e);var t=$()?"none":L.reconnect||"retry";switch(t){case"retry":se(),he(S);break;case"none":ge(!1);break;default:throw"Unrecognized advice action "+t}}else Se(e,{cause:"unsuccessful",action:L.reconnect||"retry",transport:o});else g._debug("Mismatched /meta/connect reply",e)}function Ie(e){Ce(e)?(B=!1,Se(e,{cause:"failure",action:"retry",transport:null})):g._debug("Mismatched /meta/connect failure",e)}function Le(e){ge(!0),ye(e),te("/meta/disconnect",e),te("/meta/unsuccessful",e)}function Ue(e){e.successful?(ge(!1),ye(e),te("/meta/disconnect",e)):Le(e)}function Ee(e){Le(e)}function qe(e){var t=C[e.subscription];if(t)for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];i&&!i.listener&&(delete t[n],g._debug("Removed failed subscription",i))}ye(e),te("/meta/subscribe",e),te("/meta/unsuccessful",e)}function Be(e){e.successful?(ye(e),te("/meta/subscribe",e)):qe(e)}function Fe(e){qe(e)}function Ae(e){ye(e),te("/meta/unsubscribe",e),te("/meta/unsuccessful",e)}function Me(e){e.successful?(ye(e),te("/meta/unsubscribe",e)):Ae(e)}function Oe(e){Ae(e)}function Pe(e){Te(e)||(ye(e),te("/meta/publish",e),te("/meta/unsuccessful",e))}function De(e){void 0!==e.data?Te(e)||(te(e.channel,e),A>0&&0==--A&&(g._debug("Processed last handshake-delivered message"),he(0))):void 0===e.successful?g._warn("Unknown Bayeux Message",e):e.successful?(ye(e),te("/meta/publish",e)):Pe(e)}function Ne(e){Pe(e)}function je(e){if(F=0,null!=(e=Q(e)))switch(de(e.advice),e.channel){case"/meta/handshake":ke(e);break;case"/meta/connect":Re(e);break;case"/meta/disconnect":Ue(e);break;case"/meta/subscribe":Be(e);break;case"/meta/unsubscribe":Me(e);break;default:De(e)}}function He(e){var t=C[e];if(t)for(var n in t)if(t.hasOwnProperty(n)&&t[n])return!0;return!1}function We(e,t){var n={scope:e,method:t};if(N(e))n.scope=void 0,n.method=e;else if(D(t)){if(!e)throw"Invalid scope "+e;if(n.method=e[t],!N(n.method))throw"Invalid callback "+t+" for scope "+e}else if(!N(t))throw"Invalid callback "+t;return n}function Xe(e,t,n,i){var r=We(t,n);g._debug("Adding",i?"listener":"subscription","on",e,"with scope",r.scope,"and callback",r.method);var o=++_,s={id:o,channel:e,scope:r.scope,callback:r.method,listener:i},a=C[e];return a||(a={},C[e]=a),a[o]=s,g._debug("Added",i?"listener":"subscription",s),s}this._mixin=function(e,t,n){for(var i=t||{},r=2;r<arguments.length;++r){var o=arguments[r];if(null!=o)for(var s in o)if(o.hasOwnProperty(s)){var a=P(o,s),c=P(i,s);if(a===t)continue;if(void 0===a)continue;if(e&&"object"==typeof a&&null!==a)if(a instanceof Array)i[s]=this._mixin(e,c instanceof Array?c:[],a);else{var u="object"!=typeof c||c instanceof Array?{}:c;i[s]=this._mixin(e,u,a)}else i[s]=a}}return i},this._warn=function(){H("warn",arguments)},this._info=function(){"warn"!==O.logLevel&&H("info",arguments)},this._debug=function(){"debug"===O.logLevel&&H("debug",arguments)},this._isCrossDomain=function(e){return!!(window.location&&window.location.host&&e)&&e!==window.location.host},this.send=oe,this._getCallback=function(e){return U[e]},this._putCallback=function(e,t){var n=this._getCallback(e);return N(t)&&(U[e]=t),n},this.onTransportFailure=function(e,t,n){this._debug("Transport failure",t,"for",e);var i=this.getTransportRegistry(),r=this.getURL(),s=this._isCrossDomain(W(r)[2]),a="1.0",c=i.findTransportTypes(a,s,r);if("none"===t.action){if("/meta/handshake"===e.channel&&!t.transport){var u="Could not negotiate transport, client=["+c+"], server=["+e.supportedConnectionTypes+"]";this._warn(u),pe(o.getType(),null,{reason:u,connectionType:o.getType(),transport:o})}}else if(t.delay=this.getBackoffPeriod(),"/meta/handshake"===e.channel){if(!t.transport){var l=o?o.getType():null,f=i.negotiateTransport(c,a,s,r);if(f){var h=f.getType();this._debug("Transport",l,"->",h),pe(l,h,e.failure),t.action="handshake",t.transport=f}else this._warn("Could not negotiate transport, client=["+c+"]"),pe(l,null,e.failure),t.action="none"}"none"!==t.action&&this.increaseBackoffPeriod()}else{var d=(new Date).getTime();if(0===F&&(F=d),"retry"===t.action){t.delay=this.increaseBackoffPeriod();var p=L.maxInterval;if(p>0){var m=L.timeout+L.interval+p;d-F+S>m&&(t.action="handshake")}}"handshake"===t.action&&(t.delay=0,i.reset(!1),this.resetBackoffPeriod())}n.call(g,t)},this.receive=je,f=function(e){g._debug("Received",e);for(var t=0;t<e.length;++t)je(e[t])},h=function(e,t,n){g._debug("handleFailure",e,t,n),n.transport=e;for(var i=0;i<t.length;++i){var r=t[i],o={id:r.id,successful:!1,channel:r.channel,failure:n};switch(n.message=r,r.channel){case"/meta/handshake":_e(o);break;case"/meta/connect":Ie(o);break;case"/meta/disconnect":Ee(o);break;case"/meta/subscribe":o.subscription=r.subscription,Fe(o);break;case"/meta/unsubscribe":o.subscription=r.subscription,Oe(o);break;default:Ne(o)}}},this.registerTransport=function(e,t,n){var i=v.add(e,t,n);return i&&(this._debug("Registered transport",e),N(t.registered)&&t.registered(e,this)),i},this.unregisterTransport=function(e){var t=v.remove(e);return null!==t&&(this._debug("Unregistered transport",e),N(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){v.clear()},this.getTransportTypes=function(){return v.getTransportTypes()},this.findTransport=function(e){return v.find(e)},this.getTransportRegistry=function(){return v},this.configure=function(e){X.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){if("disconnected"!==b)throw"Illegal state: handshaken";me(e,t)},this.disconnect=function(e,t,n){if(!$()){"boolean"!=typeof e&&(n=t,t=e,e=!1),N(t)&&(n=t,t=void 0);var i={id:G(),channel:"/meta/disconnect"},r=this._mixin(!1,{},t,i);g._putCallback(r.id,n),Z("disconnecting"),re(!0===e,[r],!1,"disconnect")}},this.startBatch=function(){ce()},this.endBatch=function(){le()},this.batch=function(e,t){var n=We(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(e){throw this._info("Exception during execution of batch",e),this.endBatch(),e}},this.addListener=function(e,t,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!D(e))throw"Illegal argument type: channel must be a string";return Xe(e,t,n,!0)},this.removeListener=function(e){if(!e||!e.channel||!("id"in e))throw"Invalid argument: expected subscription, not "+e;J(e)},this.clearListeners=function(){C={}},this.subscribe=function(e,t,n,i,r){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!D(e))throw"Illegal argument type: channel must be a string";if($())throw"Illegal state: disconnected";N(t)&&(r=i,i=n,n=t,t=void 0),N(i)&&(r=i,i=void 0);var o=!He(e),s=Xe(e,t,n,!1);if(o){var a={id:G(),channel:"/meta/subscribe",subscription:e},c=this._mixin(!1,{},i,a);g._putCallback(c.id,r),oe(c)}return s},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if($())throw"Illegal state: disconnected";N(t)&&(n=t,t=void 0),this.removeListener(e);var i=e.channel;if(!He(i)){var r={id:G(),channel:"/meta/unsubscribe",subscription:i},o=this._mixin(!1,{},t,r);g._putCallback(o.id,n),oe(o)}},this.resubscribe=function(e,t){if(V(e),e)return this.subscribe(e.channel,e.scope,e.callback,t)},this.clearSubscriptions=function(){z()},this.publish=function(e,t,n,i){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!D(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if($())throw"Illegal state: disconnected";N(t)?(i=t,t={},n=void 0):N(n)&&(i=n,n=void 0);var r={id:G(),channel:e,data:t},o=this._mixin(!1,{},n,r);g._putCallback(o.id,i),oe(o)},this.publishBinary=function(e,t,n,i,r){N(t)?(r=t,t=new ArrayBuffer(0),n=!0,i=void 0):N(n)?(r=n,n=!0,i=void 0):N(i)&&(r=i,i=void 0);var o={meta:i,data:t,last:n},s={ext:{binary:{}}};this.publish(e,o,s,r)},this.remoteCall=function(e,t,n,i,r){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!D(e))throw"Illegal argument type: target must be a string";if($())throw"Illegal state: disconnected";if(N(t)?(r=t,t={},n=O.maxNetworkDelay,i=void 0):N(n)?(r=n,n=O.maxNetworkDelay,i=void 0):N(i)&&(r=i,i=void 0),"number"!=typeof n)throw"Illegal argument type: timeout must be a number";e.match(/^\//)||(e="/"+e);var o="/service"+e,s={id:G(),channel:o,data:t},a=this._mixin(!1,{},i,s),c={callback:r};n>0&&(c.timeout=g.setTimeout((function(){g._debug("Timing out remote call",a,"after",n,"ms"),Pe({id:a.id,error:"406::timeout",successful:!1,failure:{message:a,reason:"Remote Call Timeout"}})}),n),g._debug("Scheduled remote call timeout",a,"in",n,"ms")),E[a.id]=c,oe(a)},this.remoteCallBinary=function(e,t,n,i,r,o){N(t)?(o=t,t=new ArrayBuffer(0),n=!0,i=void 0,r=O.maxNetworkDelay):N(n)?(o=n,n=!0,i=void 0,r=O.maxNetworkDelay):N(i)?(o=i,i=void 0,r=O.maxNetworkDelay):N(r)&&(o=r,r=O.maxNetworkDelay);var s={meta:i,data:t,last:n},a={ext:{binary:{}}};this.remoteCall(e,s,r,a,o)},this.getStatus=function(){return b},this.isDisconnected=$,this.setBackoffIncrement=function(e){O.backoffIncrement=e},this.getBackoffIncrement=function(){return O.backoffIncrement},this.getBackoffPeriod=function(){return S},this.increaseBackoffPeriod=function(){return ae()},this.resetBackoffPeriod=function(){se()},this.setLogLevel=function(e){O.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!D(e))throw"Illegal argument type: extension name must be a string";for(var n=!1,i=0;i<I.length;++i)if(I[i].name===e){n=!0;break}return n?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(I.push({name:e,extension:t}),this._debug("Registered extension",e),N(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!D(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,n=0;n<I.length;++n){var i=I[n];if(i.name===e){I.splice(n,1),t=!0,this._debug("Unregistered extension",e);var r=i.extension;N(r.unregistered)&&r.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<I.length;++t){var n=I[t];if(n.name===e)return n.extension}return null},this.getName=function(){return p},this.getClientId=function(){return T},this.getURL=function(){if(o){var e=o.getURL();if(e)return e;if(e=O.urls[o.getType()])return e}return O.url},this.getTransport=function(){return o},this.getConfiguration=function(){return this._mixin(!0,{},O)},this.getAdvice=function(){return this._mixin(!0,{},L)},this.setTimeout=function(e,t){return d.setTimeout((function(){try{g._debug("Invoking timed function",e),e()}catch(t){g._debug("Exception invoking timed function",e,t)}}),t)},this.clearTimeout=function(e){d.clearTimeout(e)},window.WebSocket&&this.registerTransport("websocket",new c),this.registerTransport("long-polling",new s),this.registerTransport("callback-polling",new a)},l=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],f=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:u,Transport:r,RequestTransport:o,LongPollingTransport:s,CallbackPollingTransport:a,WebSocketTransport:c,Utils:n,Z85:{encode:function(e){var t=null;if(e instanceof ArrayBuffer?t=e:e.buffer instanceof ArrayBuffer?t=e.buffer:Array.isArray(e)&&(t=new Uint8Array(e).buffer),null==t)throw"Cannot Z85 encode "+e;for(var n=t.byteLength,i=n%4,r=4-(0===i?4:i),o=new DataView(t),s="",a=0,c=0;c<n+r;++c){var u=c>=n;if(a=256*a+(u?0:o.getUint8(c)),(c+1)%4==0){for(var f=52200625,h=5;h>0;--h){if(!u||h>r){var d=Math.floor(a/f)%85;s+=l[d]}f/=85}a=0}}return s},decode:function(e){for(var t=e.length%5,n=5-(0===t?5:t),i=0;i<n;++i)e+=l[l.length-1];for(var r=e.length,o=new ArrayBuffer(4*r/5-n),s=new DataView(o),a=0,c=0,u=0,h=0;h<r;++h){var d=e.charCodeAt(c++)-32;if(a=85*a+f[d],c%5==0){for(var g=16777216;g>=1;)u<s.byteLength&&s.setUint8(u++,Math.floor(a/g)%256),g/=256;a=0}}return o}}}}()}}]);